{% extends 'movies/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Voice Actors</h1>

    <!-- Search Bar -->
    <form method="GET" class="mb-4">
        <div class="row">
            <div class="col-md-6">
                <input type="text" name="q" value="{{ query|default:'' }}" placeholder="Search Actors..." class="form-control">
            </div>
            <div class="col-md-3">
                <a href="?sort=name&direction={% if direction == 'asc' %}desc{% else %}asc{% endif %}" class="btn btn-outline-primary w-100">
                    Sort by Name {% if sort_by == 'name' %}
                        {% if direction == 'asc' %}
                            ↑
                        {% else %}
                            ↓
                        {% endif %}
                    {% endif %}
                </a>
            </div>
            <div class="col-md-3">
                <a href="?sort=age&direction={% if direction == 'asc' %}desc{% else %}asc{% endif %}" class="btn btn-outline-secondary w-100">
                    Sort by Age {% if sort_by == 'age' %}
                        {% if direction == 'asc' %}
                            ↑
                        {% else %}
                            ↓
                        {% endif %}
                    {% endif %}
                </a>
            </div>
        </div>
    </form>

    <!-- No Actors Found -->
    {% if actors.object_list.count == 0 %}
        <p class="text-center text-danger">No actors to display.</p>
    {% else %}
        <!-- Actors Grid -->
        <div class="row">
            {% for actor in actors %}
                <div class="col-md-3 mb-2 text-center"> <!-- Center the actor image -->
                    <div class="card h-100">
                        {% if actor.photo %}
                            <img src="{{ actor.photo.url }}" alt="{{ actor.name }}" style="max-width: 300px; max-height: 300px;" class="clickable-image actor-img mb-3" onclick="openModal('{{ actor.photo.url }}')">
                        {% else %}
                            <img src="{% static 'images/placeholder.png' %}" alt="Placeholder" style="max-width: 300px; max-height: 300px;" class="actor-img mb-3"> <!-- Placeholder image -->
                        {% endif %}
                        <h5>{{ actor.name }}</h5>
                        <p><strong>Age:</strong> {{ actor.age|default:"N/A" }}</p>
                        <p><strong>Place of Birth:</strong> {{ actor.place_of_birth|default:"N/A" }}</p>
                        <p><strong>Gender:</strong> {{ actor.gender|default:"N/A" }}</p>
                        <a href="{% url 'actor_detail' actor.pk %}" class="btn btn-sm btn-primary mt-2">View Details</a> <!-- Smaller button -->
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if actors.has_other_pages %}
            <nav>
                <ul class="pagination justify-content-center">
                    {% if actors.has_previous %}
                        <li class="page-item"><a class="page-link" href="?page={{ actors.previous_page_number }}">Previous</a></li>
                    {% endif %}
                    {% for num in actors.paginator.page_range %}
                        {% if actors.number == num %}
                            <li class="page-item active"><a class="page-link">{{ num }}</a></li>
                        {% else %}
                            <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                        {% endif %}
                    {% endfor %}
                    {% if actors.has_next %}
                        <li class="page-item"><a class="page-link" href="?page={{ actors.next_page_number }}">Next</a></li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
    {% endif %}

    <!-- Modal for Actor Images -->
    <div id="imageModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <script>
    // Modal functionality for actor images
    var modal = document.getElementById("imageModal");
    var modalImg = document.getElementById("modalImage");
    var closeBtn = document.getElementsByClassName("close")[0];

    function openModal(imageSrc) {
        modal.style.display = "block";
        modalImg.src = imageSrc;
    }

    closeBtn.onclick = function() {
        modal.style.display = "none";
    }

    modal.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    }
    </script>
</div>
{% endblock %}
